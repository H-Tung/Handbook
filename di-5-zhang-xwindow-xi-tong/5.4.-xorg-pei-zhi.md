# 5.4. Xorg 配置  
  

  
## 5.4.6. 监视器  
  
几乎所有的显示器都支持扩展显示识别数据标准（EDID）。Xorg 使用 EDID 与显示器通信，检测支持的分辨率和刷新率。然后它选择最合适的设置组合来使用该显示器。 
  
显示器支持的其他分辨率可以通过在配置文件中设置所需的分辨率来选择，或者在用 **xrandr(1)** 启动X服务器之后。 
  
### 使用 xrandr(1)  
  
在没有任何参数的情况下运行 **xrandr(1)** ，可以看到一个视频输出和检测到的显示器模式的列表。 
  
```
% xrandr
Screen 0: minimum 320 x 200, current 3000 x 1920, maximum 8192 x 8192
DVI-0 connected primary 1920x1200+1080+0 (normal left inverted right x axis y axis) 495mm x 310mm
   1920x1200     59.95*+
   1600x1200     60.00
   1280x1024     85.02    75.02    60.02
   1280x960      60.00
   1152x864      75.00
   1024x768      85.00    75.08    70.07    60.00
   832x624       74.55
   800x600       75.00    60.32
   640x480       75.00    60.00
   720x400       70.08
DisplayPort-0 disconnected (normal left inverted right x axis y axis)
HDMI-0 disconnected (normal left inverted right x axis y axis)
```

这表明，`DVI-0`输出被用来显示屏幕分辨率为`1920x1200`像素，刷新率约为 60 赫兹。监视器没有连接到`DisplayPort-0`和`HDMI-0`接口。 
  
其他任何显示模式都可以用 **xrandr(1)** 选择。例如，要切换到 60 赫兹的`1280x1024`。 
  
```
% xrandr --output DVI-0 --mode 1280x1024 --rate 60
```
  
一个常见的任务是将笔记本电脑上的外部视频输出用于视频投影仪。 

不同设备的输出连接器的类型和数量各不相同，而且每个输出的名称在不同的驱动程序中也不相同。一个驱动程序称为`HDMI-1`，另一个可能称为`HDMI1`。所以第一步是运行 **xrandr(1)** 来列出所有可用的输出。 
  
```
% xrandr
Screen 0: minimum 320 x 200, current 1366 x 768, maximum 8192 x 8192
LVDS1 connected 1366x768+0+0 (normal left inverted right x axis y axis) 344mm x 193mm
   1366x768      60.04*+
   1024x768      60.00
   800x600       60.32    56.25
   640x480       59.94
VGA1 connected (normal left inverted right x axis y axis)
   1280x1024     60.02 +  75.02
   1280x960      60.00
   1152x864      75.00
   1024x768      75.08    70.07    60.00
   832x624       74.55
   800x600       72.19    75.00    60.32    56.25
   640x480       75.00    72.81    66.67    60.00
   720x400       70.08
HDMI1 disconnected (normal left inverted right x axis y axis)
DP1 disconnected (normal left inverted right x axis y axis)
```
  
发现有四个输出：内置面板`LVDS1`，以及外部`VGA1`、`HDMI1`和`DP1`连接器。 

投影机已经连接到`VGA1`输出。现在用 **xrandr(1)** 将该输出设置为投影机的原始分辨率，并将额外的空间添加到桌面的右侧。 
  
```
% xrandr --output VGA1 --auto --right-of LVDS1
```
  
`--auto` 选择由`EDID`检测的分辨率和刷新率。如果不能正确检测到分辨率，可以用 `--mode` 而不是 `--auto` 语句给出一个固定值。例如，大多数投影仪可以使用`1024x768`的分辨率，可以用 `--mode 1024x768` 来设置。 
  
**xrandr(1)** 经常从 **.xinitrc** 运行，以便在 X 启动时设置适当的模式。 

### 在文件中设置显示器分辨率  
  
要在一个配置文件中设置 1024x768 的屏幕分辨率：  
  
> **例5. 在文件中设置屏幕分辨率**  
> **/usr/local/etc/X11/xorg.conf.d/screen-resolution.conf**  
>   
>     Section "Screen"
>     	Identifier "Screen0"
>     	Device     "Card0"
>     	SubSection "Display"
>     	Modes      "1024x768"
>     	EndSubSection
>     EndSection
  
少数没有`EDID`的显示器可以通过设置`HorizSync`和`VertRefresh`到显示器支持的频率范围来配置。 
  
> **例6. 手动设置显示器频率**  
> **/usr/local/etc/X11/xorg.conf.d/monitor0-freq.conf**  
>   
>     Section "Monitor"
>     	Identifier   "Monitor0"
>     	HorizSync    30-83   # kHz
>     	VertRefresh  50-76   # Hz
>     EndSection
  
### 5.4.7 输入设备
#### 5.4.7.1 键盘
**键盘布局**

键盘上按键的标准位置被称为布局。布局和其他可调整的参数在 xkeyboard-config(7)中列出。

默认是美国布局。要选择一个替代的布局，可以在`InputClass`中设置`XkbLayout`和`XkbVariant`选项。这将被应用于所有符合该类的输入设备。

这个例子选择了一个法语键盘布局。

> 例7. 设置键盘布局  
> /usr/local/etc/X11/xorg.conf.d/keyboard-fr.conf  
> ```
> Section	"InputClass"  
> 	Identifier	"KeyboardDefaults"  
>	MatchIsKeyboard	"on"  
>	Option		"XkbLayout" "fr"  
> EndSection
> ```

> 例8. 设置多个键盘布局  
> 设置美国、西班牙和乌克兰的键盘布局。按`Alt`+`Shift`键可以循环切换这些布局。x11/xxkb 或 x11/sbxkb 可以用来改进布局切换控制和当前布局指示。 
> ```
> /usr/local/etc/X11/xorg.conf.d/kbd-layout-multi.conf  
> Section	"InputClass"  
>	Identifier	"All Keyboards"  
>	MatchIsKeyboard	"yes"  
>	Option		"XkbLayout" "us, es, ua"  
> EndSection
> ```

**从键盘关闭 Xorg**

X 可以用一个组合键关闭。默认情况下，该组合键没有被设置，因为它与某些应用程序的键盘命令相冲突。启用这个选项需要对键盘`InputDevice`部分进行修改。

> 例 9. 启用键盘退出 X 的功能  
>```
> /usr/local/etc/X11/xorg.conf.d/keyboard-zap.conf  
> Section	"InputClass"  
>	Identifier	"KeyboardDefaults"  
>	MatchIsKeyboard	"on"  
>	Option		"XkbOptions" "terminate:ctrl_alt_bksp"  
> EndSection  
>```

#### 5.4.7.2 鼠标和指向性设备

> 重要
> 如果在 FreeBSD 12.1 下使用 xorg-server 1.20.8 或更高版本，并且不使用 moused(8) ，请在`/etc/sysctl.conf`中加入 `kern.evdev.rcpt_mask=12`。

许多鼠标参数可以通过配置选项来调整。参见 mousedrv(4) 以获得完整的列表。

**鼠标按键**

可以在 **xorg.conf** 的鼠标`InputDevice`部分设置鼠标上的按键数。将按钮的数量设置为7:

> 例 10. 设置鼠标按键的数量  
> /usr/local/etc/X11/xorg.conf.d/mouse0-buttons.conf  
> ```
> Section "InputDevice"  
>	Identifier  "Mouse0"  
>	Option      "Buttons" "7"  
> EndSection  
> ```

### 5.4.8 手动设置

在某些情况下，Xorg 的自动配置对特定的硬件不起作用，或者需要一个不同的配置。对于这些情况，可以创建一个自定义的配置文件。

> 警告  
> 除非需要，否则不要创建手动配置文件。不必要的手动配置会妨碍正常的操作。

Xorg 可以根据检测到的硬件来生成一个配置文件。这个文件通常是自定义配置的一个有用的起点。

生成一个 **xorg.conf**

    # Xorg -configure

配置文件被保存到 **/root/xorg.conf.new**。做任何需要的修改，然后用以下方法测试该文件（使用`-retro`，所以有一个可见的背景）:

    # Xorg -retro -config /root/xorg.conf.new

在新的配置调整和测试完成后，可以将它分割成更小的文件，放在一般的位置，**/usr/local/etc/X11/xorg.conf.d/**。
